<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #status{text-align: center;
            font: 1.2em "Fira Sans", sans-serif;}
        table  {
            border: 2px solid #000000;
    }
        th{border: 1px solid #000000;}
        td{border: 1px solid #808080;}
    </style>
</head>
<body>
    <h1>Программа для получения данных о зонах</h1>
    <p>Перед началом необходимо открыть режим разрабодчика и найти консоль браузера (не нужно =))</p>
    <button onclick="fuction1()">Нажать для запуска</button></br></br>
    <button onclick="fuction2()">Нажать что бы вывести результат в консоль и таблицу</button></br></br>
    <div id="status">Тут будут Статусы</div></br></br>
    <div id="table">
        <table>
            <thead>
                <tr>
                    <th>id</th>
                    <th>acnum</th>
                    <th>name_zone</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>
    </div>
    <script>
//let i=0;
//Количество секунд ожидания перед выполнением функции
const timeout = 10
//Список обработки
const listing = [
'48:03-6.628',
'48:03-6.862',
'48:03-6.1398',
//'48:03-6.1296',
//'48:03-6.654',
//'48:03-6.232',
//'48:03-6.200',
//'48:03-6.202',
//'48:03-6.1266',
//'48:03-6.877',
//'48:03-6.873',
//'48:03-6.817',
//'48:03-6.373',
//'48:03-6.1258',
//'48:03-6.708',
//'48:03-6.471',
//'48:03-6.602',
//'48:03-6.669',
//'48:03-6.637',
//'48:03-6.1649',
//'48:03-6.804',
//'48:03-6.774',
//'48:03-6.137',
//'48:03-6.277',
//'48:03-6.1560',
//'48:03-6.1562',
//'48:03-6.867',
//'48:03-6.533',
//'48:03-6.545',
//'48:03-6.166',
//'48:03-6.644',
//'48:03-6.143',
//'48:03-6.1561',
//'48:03-6.1563',
//'48:03-6.1673',
//'48:03-6.236',
//'48:03-6.525',
//'48:03-6.479',
//'48:03-6.1564',
//'48:03-6.580',
//'48:03-6.857',
//'48:03-6.1772',
//'48:03-6.432',
//'48:03-6.1591',
//'48:03-6.1593',
//'48:03-6.1596',
//'48:03-6.1313',
//'48:03-6.634',
//'48:03-6.439',
//'48:03-6.588',
//'48:03-6.285',
//'48:03-6.379',
//'48:03-6.1214',
//'48:03-6.448',
//'48:03-6.1211',
//'48:03-6.765',
//'48:03-6.610',
//'48:03-6.1301',
//'48:03-6.430',
//'48:03-6.242',
//'48:03-6.1429',
//'48:03-6.383',
//'48:03-6.922',
//'48:03-6.589',
//'48:03-6.323',
//'48:03-6.180',
//'48:03-6.565',
//'48:03-6.1475',
//'48:03-6.314',
//'48:03-6.370',
//'48:03-6.789',
//'48:03-6.183',
//'48:03-6.833',
//'48:03-6.1416',
//'48:03-6.1423',
//'48:03-6.266',
//'48:03-6.823',
//'48:03-6.1310',
//'48:03-6.1536',
//'48:03-6.819',
//'48:03-6.812',
//'48:03-6.165',
//'48:03-6.403',
//'48:03-6.536',
//'48:03-6.339',
//'48:03-6.648',
//'48:03-6.913',
//'48:03-6.920',
//'48:03-6.885',
//'48:03-6.190',
//'48:03-6.839',
//'48:03-6.818',
//'48:03-6.607',
//'48:03-6.247',
//'48:03-6.527',
//'48:03-6.182',
//'48:03-6.207',
//'48:03-6.1380',
//'48:03-6.320',
//'48:03-6.425',
//'48:03-6.820',
//'48:03-6.766',
//'48:03-6.1566',
//'48:03-6.1695',
//'48:03-6.568',
//'48:03-6.666',
//'48:03-6.153',
//'48:03-6.333',
//'48:03-6.788',
//'48:03-6.399',
//'48:03-6.858',
//'48:03-6.256',
//'48:03-6.1231',
//'48:03-6.771',
//'48:03-6.828',
//'48:03-6.424',
//'48:03-6.1501',
//'48:03-6.682',
//'48:03-6.348',
//'48:03-6.876',
//'48:03-6.1712',
//'48:03-6.485',
//'48:03-6.1697',
//'48:03-6.219',
//'48:03-6.846',
//'48:03-6.364',
//'48:03-6.700',
//'48:03-6.733',
//'48:03-6.1215',
//'48:03-6.785',
//'48:03-6.431',
//'48:03-6.821',
//'48:03-6.1643',
//'48:03-6.302',
//'48:03-6.129',
//'48:03-6.396',
//'48:03-6.925',
//'48:03-6.1390',
//'48:03-6.1619',
//'48:03-6.1212',
//'48:03-6.1634',
//'48:03-6.896',
//'48:03-6.803',
//'48:03-6.627',
//'48:03-6.1706',
//'48:03-6.1257',
//'48:03-6.1260',
//'48:03-6.1304',
//'48:03-6.1316',
//'48:03-6.1440',
//'48:03-6.390',
//'48:03-6.897',
//'48:03-6.316',
//'48:03-6.586',
//'48:03-6.433',
//'48:03-6.1680',
//'48:03-6.420',
//'48:03-6.716',
//'48:03-6.801',
//'48:03-6.844',
//'48:03-6.1701',
//'48:03-6.492',
//'48:03-6.547',
//'48:03-6.1164',
//'48:03-6.1303',
//'48:03-6.119',
//'48:03-6.567',
//'48:03-6.318',
//'48:03-6.367',
//'48:03-6.908',
//'48:03-6.141',
//'48:03-6.935',
//'48:03-6.377',
//'48:03-6.645',
//'48:03-6.270',
//'48:03-6.561',
//'48:03-6.904',
//'48:03-6.1275',
//'48:03-6.1326',
//'48:03-6.1452',
//'48:03-6.239',
//'48:03-6.290',
//'48:03-6.445',
//'48:03-6.278',
//'48:03-6.521',
//'48:03-6.325',
//'48:03-6.709',
//'48:03-6.874',
//'48:03-6.1224',
//'48:03-6.134',
//'48:03-6.1442',
//'48:03-6.670',
//'48:03-6.434',
//'48:03-6.1385',
//'48:03-6.1456',
//'48:03-6.796',
//'48:03-6.869',
//'48:03-6.421',
//'48:03-6.1291',
//'48:03-6.246',
//'48:03-6.504',
//'71:13-6.449',
//'71:13-6.450',
//'48:03-6.728',
//'48:03-8.111',
//'48:03-6.912',
//'48:03-6.722',
//'48:03-6.1270',
//'48:03-6.327',
//'48:03-6.1293',
//'48:03-6.1387',
//'48:03-6.349',
//'48:03-6.792',
//'48:03-6.108',
//'48:03-6.576',
//'48:03-6.398',
//'48:03-6.882',
//'48:03-6.161',
//'48:03-6.1274',
//'48:03-6.1306',
//'48:03-6.701',
//'48:03-6.1321',
//'48:03-6.566',
//'48:03-6.177',
//'48:03-6.1724',
//'48:03-6.526',
//'48:03-6.231',
//'48:03-6.918',
//'48:03-6.830',
//'48:03-6.409',
//'48:03-6.1648',
//'48:03-6.763',
//'48:03-6.646',
//'48:03-6.1273',
//'48:03-6.791',
//'48:03-6.1382',
//'48:03-6.1457',
//'48:03-8.103',
//'48:03-6.1636',
//'48:03-6.776',
//'48:03-6.899',
//'48:03-6.779',
//'48:03-6.683',
//'48:03-6.802',
//'48:03-6.618',
//'48:03-6.1474',
//'48:03-6.1719',
//'48:03-6.1721',
//'48:03-6.1386',
//'48:03-6.245',
//'48:03-6.706',
//'48:03-6.684',
//'48:03-6.718',
//'48:03-6.680',
//'48:03-6.483',
//'48:03-6.880',
//'48:03-6.911',
//'48:03-6.304',
//'48:03-6.452',
//'48:03-6.1283',
//'48:03-6.1757',
//'48:03-6.1277',
//'48:03-6.328',
//'48:03-6.552',
//'48:03-6.883',
//'48:03-6.233',
//'48:03-6.599',
//'48:03-6.1715',
//'48:03-6.574',
//'48:03-6.1298',
//'48:03-6.391',
//'48:03-6.226',
//'48:03-6.131',
//'48:03-6.444',
//'48:03-6.322',
//'48:03-6.111',
//'48:03-6.1703',
//'48:03-6.678',
//'48:03-6.773',
//'48:03-6.138',
//'48:03-6.139',
//'48:03-6.807',
//'48:03-6.223',
//'48:03-6.191',
//'48:03-6.454',
//'48:03-6.417',
//'48:03-6.714',
//'48:03-6.926',
//'48:03-6.1339',
//'48:03-6.1374',
//'48:03-6.860',
//'48:03-6.179',
//'48:03-6.308',
//'48:03-6.815',
//'48:03-6.1726',
//'48:03-6.1454',
//'48:03-6.173',
//'48:03-6.1290',
//'48:03-6.1534',
//'48:03-6.1589',
//'48:03-6.389',
//'48:03-6.406',
//'48:03-6.664',
//'48:03-6.157',
//'48:03-6.186',
//'48:03-6.968',
//'48:03-6.490',

    ]
//Выходной список
let outputData = []
//Функция
async function fetching (i=0){

//запросник
let url =`https://pkk.rosreestr.ru/api/features/10/${listing[i]}`
//let url =`https://jsonplaceholder.typicode.com/posts/${1}`
//let encoded = encodeURI(url);
console.log(`Запрашиваю ${url}`)
document.querySelector('#status').innerHTML=`Запрашиваю ${url}`

console.log(`Запускаю через минуту, ${new Date()}`)
document.querySelector('#status').innerHTML=`Запускаю через минуту, ${new Date()}`
setTimeout(async ()=>{
console.log("Запускаю", new Date())
document.querySelector('#status').innerHTML=`Запускаю, ${new Date()}`
await fetch(url,
    {
        "method": "GET",
        "transformRequest": [
          null
        ],
        "transformResponse": [
          null
        ],
        "jsonpCallbackParam": "callback",
        "url": url,
        "headers": {
            "Content-Type": "application/json",
            "Accept": "application/json, text/plain, */*",
           // "access-control-allow-origin": "*"
        },
        "data": "",
        "timeout": {}
    }

    )
    .then((resp) => {
        console.log(resp.status)
        if (resp.status==200){
        //console.log(console.log(resp))
        resp.json().then(json => {
            console.log(`Элемент ${listing[i]} обработан`)
            document.querySelector('#status').innerHTML=`Элемент ${listing[i]} обработан, ${resp.status}, ${new Date()}`
            outputData[i]=[]
            outputData[i][0]=json.feature.attrs.id
            outputData[i][1]=json.feature.attrs.acnum
            outputData[i][2]=json.feature.attrs.name_zone
            let table = document.querySelector('tbody')
            table.innerHTML+=`<tr><td>${json.feature.attrs.id}</td><td>${json.feature.attrs.acnum}</td><td>${json.feature.attrs.name_zone}</td></tr>`
            i++
            if (i>=listing.length){
                console.log('Закончил');
                return document.querySelector('#status').innerHTML='Закончил'
            }else{
            console.log(`Обрабатываю Элемент ${listing[i]}`)
            document.querySelector('#status').innerHTML=`Обрабатываю Элемент ${listing[i]}, ${new Date()}`
            setTimeout(()=>{fetching (i)},timeout*1000)}
            //console.log(json)
        
    })}
})
    .catch((err)=>{
        console.log(`ОЙ, Error, запускаю снова через минуту", ${new Date()}`)
        document.querySelector('#status').innerHTML=`ОЙ, Error, запускаю снова через минуту", ${new Date()}`
        //console.log("ОЙ, Error, запускаю снова", listing[i])
        setTimeout(()=>{fetching (i)},timeout*1000)
/*         console.log (i++)
        if (i<=10){
            fetching()
            console.log (i)
        } */
    })},timeout*1000)
}

//import fetch from 'node-fetch';

//const response = await fetch('https://httpbin.org/status/301', { redirect: 'manual' });
//console.log(response.status)
async function fuction1(){
    await fetching()
}

//setTimeout(() => console.log (outputData), 5000)

function fuction2(){
    //console.log (outputData)
    const table = document.querySelector('tbody')
    outputData.forEach((list)=>{
        table.innerHTML+=`<tr><td>${list[0]}</td><td>${list[1]}</td><td>${list[2]}</td></tr>`
    })
}
//await fetching(list)


    </script>
</body>
</html>